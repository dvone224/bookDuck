<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- 기존 head 내용 유지 (header 프래그먼트는 주석 처리 또는 실제 경로로) -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://kit.fontawesome.com/116a85af51.js" crossorigin="anonymous"></script>
    <title>BookDuck² :: 명예의 전당</title>
    <style>



        /*아이콘 임포트*/
        /* Fontawesome 4.7 */
        @import url('https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css');

        /*로고용 폰트: cafe24슈퍼매직*/
        @font-face {
            font-family: 'Cafe24Supermagic-Bold-v1.0';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2307-2@1.0/Cafe24Supermagic-Bold-v1.0.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
        }

        /*홈페이지 메인 폰트: 고운바탕*/
        @font-face {
            font-family: 'GowunBatang-Regular';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/GowunBatang-Regular.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        /*고운돋움*/
        @font-face {
            font-family: 'GowunDodum-Regular';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/GowunDodum-Regular.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        /*조선굴림*/
        @font-face {
            font-family: 'ChosunGu';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_20-04@1.0/ChosunGu.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        /*온글잎콘콘*/
        @font-face {
            font-family: 'Ownglyph_corncorn-Rg';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/2412-1@1.0/Ownglyph_corncorn-Rg.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }

        /*나눔손글씨펜*/
        @import url('//fonts.googleapis.com/earlyaccess/nanumpenscript.css');
        /*font-family: 'NanumPen';*/

        /*학교안심꼬꼬마*/
        @font-face {
            font-family: 'TTHakgyoansimKkokkomaR';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2402_keris@1.0/TTHakgyoansimKkokkomaR.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }

        /*심경하*/
        @font-face {
            font-family: 'SimKyungha';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2202-2@1.0/SimKyungha.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        /*다이어리*/
        @font-face {
            font-family: 'EarlyFontDiary';
            src: url('https://gcore.jsdelivr.net/gh/projectnoonnu/noonfonts_220508@1.0/EarlyFontDiary.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }

        /* 컬러 파레트 */
        :root{
            --main-color-dark: #00479B;
            --main-color-middle: #83C7FF;
            --main-color-light: #E3F4FF;
            --assist-color-dark: #CE7000;
            --assist-color-middle: #FFB90B;
            --assist-color-light: #FFF7E6;
            --cancle-color-dark: #9B9B9B;
            --cancle-color-middle: #D3D3D3;
            --cancle-color-light: #EAEAEA;
            --crown-color: #ffa500;

            /*사용법: var(--main-color-middle)*/
            --border-big: 20px;/*큰거...뭐가잇지...*/
            --border-middle: 10px;/*img*/
            --border-circle: 50%;/*동그리버튼*/

            /*폰트 사이즈 정의*/
            --font-size-0: 28px;
            --font-size-1: 23px;
            --font-size-2: 18px;
            --font-size-3: 13px;
            --font-size-4: 8px;

            /*쪽지 색상 지정*/
            --memo1-color-dark: #00479B;
            --memo1-color-middle: #83C7FF;
            --memo1-color-light: #E3F4FF;
            --memo1-color-back: #B0CAD6;

            --memo2-color-dark: #CE7000;
            --memo2-color-middle: #FFB90B;
            --memo2-color-light: #FFF7E6;
            --memo2-color-back: #EAD4AD;

            --memo3-coler-dark: #841A1A;
            --memo3-coler-middle: #FF9494;
            --memo3-coler-light: #FFE9E9;
            --memo3-coler-back: #D6B0B0;

            --memo4-coler-dark: #325900;
            --memo4-coler-middle: #97CE41;
            --memo4-coler-light: #F6FFD9;
            --memo4-coler-back: #CCD3AE;

            --memo5-coler-dark: #A04800;
            --memo5-coler-middle: #FF8B00;
            --memo5-coler-light: #FFE3CA;
            --memo5-coler-back: #C9A88D;

            --memo6-coler-dark: #6A297A;
            --memo6-coler-middle: #AF80CE;
            --memo6-coler-light: #F5EEFF;
            --memo6-coler-back: #CDC3DD;

            --memo7-coler-dark: #1F1F77;
            --memo7-coler-middle: #7A8CE5;
            --memo7-coler-light: #E9ECFF;
            --memo7-coler-back: #B2B8D3;

            --memo8-coler-dark: #006466;
            --memo8-coler-middle: #66C6DD;
            --memo8-coler-light: #EBFFFF;
            --memo8-coler-back: #B8D3D2;
        }

        /* Global 스타일 초기화 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Gowun Batang";
            font-size: var(--font-size-2);
        }

        /* 기본 설정 */
        body {
            margin: 0;
            padding: 0;
            width: 100%; /* 가로를 화면에 맞게 설정 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }


        /* 컨테이너 스타일 */
        .container {
            /*border: 1px solid slateblue;*/
            /*width: 100%;*/
            width: 768px;
            /*            max-width: 768px;*/
            /*max-width: 100%; !* 컨테이너 너비를 화면 너비에 맞춤 *!*/
            padding: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        header{
            width: 768px;
            /*            max-width: 768px;*/
        }

        /*버튼 기본 규격*/
        .btn_circle{
            /*            border: 1px solid red;*/
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            margin: 10px;
            /*            font-size: 20px;*/
        }

        .btn_circle .btn_icon{
            width: 25px;
            height: 25px;
            cursor: pointer;
        }

        .btn_circle .btn_icon_color{
            width: 35px;
            height: 35px;
            cursor: pointer;
        }

        .btn_circle_big{
            width: 55px;
            height: 55px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
        }

        .btn_circle_big .btn_icon{
            width: 45px;
            height: 45px;
            cursor: pointer;
        }

        .btn_long{
            width: 100%;
            height: 45px;
            border-radius: 45px;
            color: white;
            cursor: pointer;
            border: none;
            font-weight: bold;
            max-width: 768px;
        }

        .btn_mini{
            width: auto;
            height: 25px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            border: none;
            font-size: var(--font-size-3);
            font-weight: bold;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            margin-left: 5px;
        }

        .box{
            width: 100%;
            height: auto;
            border-radius: var(--border-big);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            max-width: 768px;
        }

        .title{
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 10px;
            font-weight: bold;
        }

        .bold{
            font-weight: bold;
        }

        .dot{
            width: 15px;
            height: 15px;
            border-radius: var(--border-circle);
            display: flex;
            margin-top: 5px;
            margin-right: 5px;
        }

        .underline{
            width: 130%;
            height: 1px;
        }

        .line{
            width: 100%;
            height: 1px;
        }

        .blue{
            background: var(--main-color-middle);
        }
        .blue2{
            color: var(--main-color-middle);
        }
        .yellow{
            background: var(--assist-color-middle);
        }
        .dark_blue1{
            background: var(--main-color-dark);
        }
        .dark_yellow1{
            background: var(--assist-color-dark);
        }
        .dark_blue2{
            color: var(--main-color-dark);
        }
        .dark_yellow2{
            color: var(--assist-color-dark);
        }
        .light_blue{
            background: var(--main-color-light);
        }
        .light_yellow{
            background: var(--assist-color-light);
        }
        .dark_gray1{
            background: var(--cancle-color-dark);
        }
        .dark_gray2{
            color: var(--cancle-color-dark);
        }
        .gray{
            background: var(--cancle-color-middle);
        }
        .gray2{
            color: var(--cancle-color-middle);
        }
        .light_gray{
            background: var(--cancle-color-light);
        }
        .white{
            background: white;
        }
        .white2{
            color: white;
        }

        .blue_line_thin{
            border: 1px solid var(--main-color-middle);
        }
        .yellow_line_thin{
            border: 1px solid var(--assist-color-middle);
        }

        .input_long{
            /*            margin-bottom: 10px;*/
            width: 100%;
            height: 45px;
            border-radius: 45px;
            box-sizing: border-box;
            text-align: center;
            max-width: 768px;
        }

        .blue_line{
            border: 2px solid var(--main-color-middle);
            color: var(--main-color-dark);
        }

        .blue_line:focus{
            border: 4px solid var(--main-color-middle);
            color: var(--main-color-dark);
            outline: none;
        }

        .yellow_line{
            border: 2px solid var(--assist-color-middle);
            color: var(--assist-color-dark);
        }

        .yellow_line:focus{
            border: 4px solid var(--assist-color-middle);
            color: var(--assist-color-dark);
            outline: none;
        }


        /*체크박스 CSS*/

        input[type="checkbox"]{
            display: none;
        }
        input[type="checkbox"] + label{
            margin-right: 5px;
            display: inline-block;
            background: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            position: relative;
        }
        /*input[type="checkbox"] + label{
            border:3px solid var(--main-color-middle);
        }*/
        /*input[type="checkbox"] + label{
            border:3px solid var(--assist-color-middle);
        }*/
        input[type="checkbox"]:checked + label::after {
            content: '✔';
            font-size: 16px; /* 체크 아이콘 크기 조정 */
            width: 22px; /* 내부 원 크기 */
            height: 22px; /* 내부 원 크기 */
            border: none; /* 중복 테두리 제거 */
            color: white;
            text-align: center;
            line-height: 19px; /* 내부 원 높이와 동일하게 설정 */
            position: absolute;
            left: 50%; /* 중앙 정렬 */
            top: 50%; /* 중앙 정렬 */
            transform: translate(-50%, -50%); /* 정확한 중앙 배치 */
            border-radius: 50%; /* 내부 원형 유지 */
        }
        /*input[type="checkbox"]:checked + label::after{
            background: var(--main-color-middle);
        }*/
        /*input[type="checkbox"]:checked + label::after{
            background: var(--assist-color-middle);
        }*/

        /*대표 이미지들 설정*/
        .processImg{
            width: 300px;
            height: 300px;
        }
        .processImg img{
            width: 100%;
            height: 100%;
        }

        .error{
            color: red;
            margin: 5px;
            text-align: center;
            font-size: var(--font-size-2);
        }


        @media screen and (max-width: 768px) { /* 768px 이하 화면 (태블릿 및 모바일) */
            .container {
                width: 100%;
            }
            header{
                width: 100%;
            }
        }

        @media screen and (max-width: 480px) { /* 480px 이하 화면 (스마트폰) */
            .container {
                padding: 5px; /* 모바일 화면에서는 여백 줄이기 */
                font-size: 14px; /* 작은 화면에 맞는 글꼴 크기 조정 */
            }
        }

        /* 여기까지 메인 CSS */


        .header_one {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px; }

        .header_one_top, .header_right{
            display: flex;
        }

        .header_one_top {
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 10px 0;
        }

        .logo{
            width: 150px;
            height: 40px;
            font-family: 'Cafe24Supermagic-Bold-v1.0';
            font-size: var(--font-size-0);
            color: var(--main-color-dark);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            text-decoration: none;
        }

        /*헤더 메뉴*/
        .header_one_bottom{
            display: flex;
            flex-direction: column;
        }

        .box_none{
            display: flex;
            width: 100%;
        } /*!* 메뉴 레이아웃 *!*/

        .box_none2{
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .point_menu{
            height: 2px;
            width: 30%;
            background: var(--main-color-dark);
        }
        /*!* 두께 증가 *!*/
        .menu{
            height: auto; /*!* 내용에 맞게 *!*/
            padding: 10px 0; /*!* 상하 패딩 *!*/
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center; /*!* 중앙 정렬 *!*/
            color: var(--cancle-color-dark);
            transition: color 0.3s, font-weight 0.3s;
            cursor: pointer;
            text-decoration: none;
            font-size: var(--font-size-2);
        }

        .menu:hover {
            color: var(--main-color-dark);
        }

        .this_page {
            /*border: 1px solid red;*/
            width: 100px;
            color: var(--main-color-dark);
            font-weight: bold;
        }

        /*!* "모임 생성하기" 버튼 스타일 *!*/
        .btn_box {
            background-color: var(--main-color-middle);
            color: white;
            font-weight: bold;
            text-align: center;
            line-height: 100px; /*!* 텍스트 수직 중앙 정렬 *!*/
            cursor: pointer;
            transition: background-color 0.2s;
            border-radius: var(--border-middle);
        }
        .btn_box:hover {
            background-color: var(--main-color-dark);
        }

        .search-area-board{
            /*            border: 1px solid blue;*/
            width: 100%;
            position: relative;
            margin-bottom: 10px;
        }

        .btn_circle_mini{
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            padding: 0;
            position: absolute;
            top: 50%;
            right: 5px;
            transform: translateY(-50%);
        }

        .controls-container{
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn_book{
            width: 150px;
            height: 30px;
            border-radius: 30px;
            border: none;
            background: var(--assist-color-middle);
            font-size: var(--font-size-3);
            color: white;
            font-weight: bold;
            transition: background 0.3s ease;

        }

        .btn_book:hover{
            background: var(--assist-color-dark);
        }

        /*드롭다운 메뉴 꾸미기*/
        .sort-dropdown {
            width: 100px; /* 필요시 조정 가능 */
            position: relative;
            font-size: var(--font-size-2);
            color: var(--assist-color-dark);
        }

        .sort-dropdown select {
            width: 100%;
            padding: 8px 12px;
            border: none;
            background-color: #fff;
            font-size: var(--font-size-2);
            font-weight: 500;
            color: var(--assist-color-dark);
            appearance: none; /* 기본 브라우저 스타일 제거 */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg width='12' height='8' viewBox='0 0 12 8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1.41 0L6 4.59 10.59 0 12 1.41 6 7.41 0 1.41z' fill='%23FFB90B'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 12px 8px;
            cursor: pointer;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .sort-dropdown select:focus,
        .sort-dropdown select:hover {
            outline: none;
        }


        /*!* 게시글 목록 스타일 *!*/
        .board-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px; width: 100%;
        }

        @media (max-width: 400px) {
            .board-list {
                grid-template-columns: 1fr;
            }
        }

        .board-item {
            /*            border: 1px solid red;*/
            border-radius: var(--border-middle);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .board-item-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .board-item-cover {
            width: 150px;
            height: 200px;
            object-fit: cover;
            border-radius: var(--border-middle);
            background-color: #f0f0f0;
            flex-shrink: 0;
        }

        .board-item-info {
            flex-grow: 1;
        }

        .board-item-book-title {
            font-size: var(--font-size-2);
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            /*            line-height: 1.3;
                        display: -webkit-box;
                        -webkit-line-clamp: 2;
                        -webkit-box-orient: vertical;
                        overflow: hidden;
                        text-overflow: ellipsis;*/
        }

        .box_groupname{
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }

        .board-item-group-name {
            font-size: var(--font-size-2);
            display: flex;
            justify-content: center;
            align-items: center;
            /*            padding: 3px 8px;
                        border-radius: 10px;
                        display: inline-block;
                        margin-top: 4px;*/
        }

        .crew_text{
            margin-left: 5px;
            font-size: var(--font-size-3);
        }

        /*        .board-item-date {
                    font-size: 0.8em;
                    color: #777;
                    text-align: right;
                    margin-top: auto;
                    padding-top: 10px;
                }*/
        .no-boards-message {
            text-align: center;
            padding: 40px;
            color: #777;
            font-size: 1.1em;
            width: 100%;
        }

        .test{
            border: 1px solid red;
        }

    </style>
</head>
<body>
<header>
    <div class="header_one">
        <div class="header_one_top">
            <div class="heaer_left">
                <a href="/home" class="logo">BookDuck²</a>
            </div>
            <div class="header_right">
                <div sec:authorize="isAuthenticated()" class="btn_circle cart-btn">
                    <i class="fa-solid fa-cart-shopping blue2 btn_icon_color"></i>
                </div>
                <div sec:authorize="isAuthenticated()" class="btn_circle user-btn">
                    <i class="fa-solid fa-user blue2 btn_icon_color"></i>
                </div>
            </div>
        </div>
        <div class="header_one_bottom">
            <div class="box_none">
                <a href="/home" class="menu this_page">명예의 전당</a>
                <a href="/shop/shopList" class="menu">북덕이 서점</a>
            </div>
            <div class="box_none">
                <div class="box_none2"><div class="point_menu"></div></div>
                <div class="box_none2"></div>
            </div>
            <div class="box_none">
                <div class="line gray"></div>
            </div>
        </div>
    </div>
</header>

<div class="container">
    <div class="box btn_box blue" onclick="location.href='/group/addGroup'">
        모임 생성하기
    </div>
    <div class="box_none">
        <div class="search-area-board">
            <input class="input_long yellow_line" type="text" id="boardSearchQueryInput" placeholder="책 제목으로 게시글 검색" th:value="${currentQuery}" aria-label="게시글 검색">
            <button class="btn_circle_mini yellow" type="button" id="boardSearchButton" aria-label="검색"><i class="fas fa-search white2"></i></button>
        </div>
    </div>
    <div class="controls-container">
        <div class="filter-button">
            <button class="btn_book" type="button" id="filterAllBoardsBtn" th:classappend="${!currentFilterMyBooks} ? 'active'" >모든 책 보기</button>
            <button class="btn_book" type="button" id="filterMyOwnedBooksBtn" th:classappend="${currentFilterMyBooks} ? 'active'" th:disabled="${loginuser == null}">내가 구매한 책만 보기</button>
        </div>
        <div class="sort-dropdown">
            <select id="boardSortOptions">
                <option value="createdAt_DESC" th:selected="${currentSortBy == 'createdAt' and currentSortDir == 'DESC'}">최신순</option>
                <option value="createdAt_ASC"  th:selected="${currentSortBy == 'createdAt' and currentSortDir == 'ASC'}">오래된순</option>
            </select>
        </div>
    </div>
    <div class="board-list" th:if="${not #lists.isEmpty(boards)}">
        <div class="board-item" th:each="boardDto : ${boards}" th:data-board-id="${boardDto.boardId}">
            <div class="board-item-header">
                <img th:src="${boardDto.bookCover ?: '/img/default_book_cover.png'}"
                     th:alt="${boardDto.bookTitle}" class="board-item-cover"
                     onerror="this.onerror=null; this.src='/img/default_book_cover.png';"/>
                <div class="board-item-info">
                    <div class="box_groupname">
                        <div class="board-item-group-name" th:text="${boardDto.groupName}">그룹 이름</div><span class="crew_text">CREW</span>
                    </div>
                    <div class="board-item-book-title" th:title="${boardDto.bookTitle}" th:text="${boardDto.bookTitle}">책 제목</div>
                </div>
            </div>
        </div>
    </div>
    <div th:if="${#lists.isEmpty(boards)}" class="no-boards-message">
        <p>표시할 게시글이 없습니다.</p>
    </div>
</div>

<footer th:replace="~{fragments/footer :: footer}"></footer>

<script th:inline="javascript">
    /*<![CDATA[*/
    // 로그인 상태를 서버로부터 받아옴
    const isLoggedIn = /*[[${isLoggedIn}]]*/ false;

    // 현재 필터, 정렬, 검색 상태
    let currentBoardQuery = /*[[${currentQuery}]]*/ '';
    let currentBoardFilterMyBooks = /*[[${currentFilterMyBooks}]]*/ false;
    let currentBoardSortBy = /*[[${currentSortBy}]]*/ 'createdAt';
    let currentBoardSortDir = /*[[${currentSortDir}]]*/ 'DESC';

    // HTML 요소 참조
    const boardSearchQueryInput = document.getElementById('boardSearchQueryInput');
    const boardSearchButton = document.getElementById('boardSearchButton');
    const filterAllBoardsBtn = document.getElementById('filterAllBoardsBtn');
    const filterMyOwnedBooksBtn = document.getElementById('filterMyOwnedBooksBtn');
    const boardSortOptionsSelect = document.getElementById('boardSortOptions');
    const cartButton = document.querySelector('.cart-btn');
    const userButton = document.querySelector('.user-btn');
    const boardList = document.querySelector('.board-list');

    // 필터, 정렬, 검색 조건 변경 시 페이지 리로드 함수
    function applyBoardSearchAndFilters() {
        const url = new URL(window.location.pathname, window.location.origin);
        const queryValue = boardSearchQueryInput.value.trim();
        if (queryValue) {
            url.searchParams.set('query', queryValue);
        } else {
            url.searchParams.delete('query');
        }
        url.searchParams.set('filterMyBooks', String(currentBoardFilterMyBooks));
        const sortValue = boardSortOptionsSelect.value;
        const parts = sortValue.split('_');
        url.searchParams.set('sortBy', parts[0]);
        url.searchParams.set('sortDir', parts[1]);
        console.log("Applying board filters and sort. URL:", url.toString());
        window.location.href = url.toString();
    }

    // 이벤트 리스너 설정
    if (boardSearchButton) {
        boardSearchButton.addEventListener('click', () => {
            applyBoardSearchAndFilters();
        });
    }

    if (boardSearchQueryInput) {
        boardSearchQueryInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                applyBoardSearchAndFilters();
            }
        });
    }

    if (filterAllBoardsBtn) {
        filterAllBoardsBtn.addEventListener('click', () => {
            currentBoardFilterMyBooks = false;
            applyBoardSearchAndFilters();
        });
    }

    if (filterMyOwnedBooksBtn && !filterMyOwnedBooksBtn.disabled) {
        filterMyOwnedBooksBtn.addEventListener('click', () => {
            currentBoardFilterMyBooks = true;
            applyBoardSearchAndFilters();
        });
    }

    if (boardSortOptionsSelect) {
        boardSortOptionsSelect.addEventListener('change', () => {
            applyBoardSearchAndFilters();
        });
    }

    // 장바구니 버튼 클릭 이벤트
    if (cartButton) {
        cartButton.addEventListener('click', function() {
            if (isLoggedIn) {
                window.location.href = '/cart/cartList';
            } else {
                alert('로그인 먼저 해주세요');
                window.location.href = '/login-form';
            }
        });
    }

    // 마이페이지 버튼 클릭 이벤트
    if (userButton) {
        userButton.addEventListener('click', function() {
            if (isLoggedIn) {
                window.location.href = '/userinfo';
            } else {
                alert('로그인 먼저 해주세요');
                window.location.href = '/login-form';
            }
        });
    }

    // 책 요소 클릭 이벤트
    if (boardList) {
        boardList.addEventListener('click', function(event) {
            const clickedItem = event.target.closest('.board-item');
            if (clickedItem) {
                const boardId = clickedItem.dataset.boardId;
                console.log("Board ID clicked:", boardId);
                if (isLoggedIn) {
                    if (boardId && /^\d+$/.test(boardId)) {
                        window.location.href = `/board/${encodeURIComponent(boardId)}`;
                    } else {
                        alert('게시글 정보가 올바르지 않습니다.');
                        console.error("Invalid or missing board ID:", boardId);
                    }
                } else {
                    alert('로그인 먼저 해주세요');
                    window.location.href = '/login-form';
                }
            }
        });
    }

    // 페이지 로드 시 UI 상태 반영
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Board list page initialized with state:", {
            query: currentBoardQuery,
            filterMyBooks: currentBoardFilterMyBooks,
            sortBy: currentBoardSortBy,
            sortDir: currentBoardSortDir
        });
    });

    /*]]>*/
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'93ca3c31ad1144df',t:'MTc0NjcyMDcwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>